
<h1><%= @book.title %></h1>
<h1><%= "by #{@book.author}"  %></h1>
<h2><%= @book.genre %></h2>


<!-- display current users rating of the book if it exitists -->
<% if user_signed_in? %>
<% if current_user.books.include? @book  %>
<% if current_user.user_books.find{|f| f.book_id == @book.id}.rating != nil %>
<h2>Your rating = <%= current_user.user_books.find{|f| f.book_id == @book.id}.rating %> </h2>
<% end %>
<% end %>
<% end %>
<div>
  <% if @book.user_books.count(:rating) > 0 %>
  <h4> Avg Rating =<%= @book.user_books.average(:rating).round(1) %> from <%= @book.user_books.count(:rating)  %> ratings</h4>
  <% else %>

  <% end %>
</div>
  <!-- If statement to identify if the books has just been added to give option to delete if wrong book -->
  <% if @book.created_by == current_user.id && @book.user_books.count == 0 && @book=Book.last %>
   <h2><%= link_to "Not the book you're looking for?", book_path(@book), method: :delete  %></h2>
  <% end %>


<%= cl_image_tag(@book.photo.path, width: 256, height: 400, crop: :fill)  %>
<p><%= @book.description %></p>
<h4>Page count =<%= @book.page_count %>. ISBN =<%= @book.isbn %></h4>
<% if user_signed_in? %>
<%= render "user_book_form" %>
<% end %>


<!-- delete this -->
<% @book.users.each do |user| %>
<%= link_to user[:username], book_user_book_path(@book, @book.user_books)   %>
<%= user.user_books.find{|f| f.book_id == @book.id}.rating %>
<% end %>


<!-- shows which other users have this book,there rating and a link to their books -->
<% @book.users.each do |user| %>
<% if user !=current_user %>
<%= simple_form_for [@book, user], url: book_user_book_path(@book, user), method: :get  do |f| %>
<%= f.input :have_or_want, :as => :hidden, :input_html => { :value => true } %>
<%= f.submit "#{user[:username]}-#{user.user_books.find{|f| f.book_id == @book.id}.rating}" %>
<% end %>
<% end %>
<% end %>


<%= simple_form_for [@book, @comment], url: book_comments_path(@book, @comment), method: :post  do |f| %>

<%= f.input :content %>
<%= f.submit "Submit comments" %>
<% end %>

<% @book.comments.map do |comment| %>
<h4><%= comment.user.username %> said: <%= comment.content %> </h4>
<% end %>

<h2><%= link_to "Edit this book", edit_book_path %></h2>
<h2><%= link_to "Back to Library", books_path %></h2>
<h2> <%= link_to "My Bookshelf", my_books_books_path %> </h2>
